<!doctype html><html><head><title>Map corner coordinates in QGIS</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/favicon_hu8376fd15465fef26ffe66b6bcf0ca686_13669_42x0_resize_box_2.png><link rel=stylesheet href=/css/style.css><meta name=description content="Map corner coordinates in QGIS"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/main-logo_hu864bbe108f1be1ae04b57f7f2fd9d631_5637_42x0_resize_box_2.png alt=Logo>Alexandre Neto</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=languageSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img class=flag src=https://www.countryflags.io/gb/flat/16.png alt=gb>
English</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/pt/posts/tutorials/2014-09-09-coordenadas-dos-cantos-do-mapa-em-qgis-map-corner-coordinates-in-qgis><img class=flag src=https://www.countryflags.io/pt/flat/24.png alt=pt>
Português</a></div></li></ul></div></div><img src=/images/main-logo_hu864bbe108f1be1ae04b57f7f2fd9d631_5637_42x0_resize_box_2.png class=d-none id=main-logo alt=Logo>
<img src=/images/inverted-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_42x0_resize_box_2.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=https://srnetochan.github.io/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href=/posts/opinion/>Opinion articles</a><ul><li><a href=/posts/opinion/2013-03-26-nota-de-abertura/>Welcome note</a></li><li><a href=/posts/opinion/2013-03-31-porque-o-open-source/>Open Source, why?</a></li></ul></li><li><a href=/posts/news/>News</a></li><li><a href=/posts/tutorials/>Tutorials</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://srnetochan.github.io/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/aneto2.jpg alt="Author Image"><h5 class=author-name>Alexandre Neto</h5><p>September 9, 2014</p></div><div class=title><h1>Map corner coordinates in QGIS</h1></div><div class=post-content id=post-content><p>Some time ago in the <a href=http://osgeo-org.1560.x6.nabble.com/QGIS-pt-f5128248.html>qgis-pt mailing list</a>, someone asked <a href=http://osgeo-org.1560.x6.nabble.com/QGIS-Layout-coordenadas-nos-4-cantos-do-mapa-tt5140019.html>how to show the coordinates of a map corners using QGIS</a>. Since this features wasn&rsquo;t available (yet), I have tried to reach a automatic solution, but without success,  After some thought about it and after reading a <a href=http://nathanw.net/2012/11/10/user-defined-expression-functions-for-qgis/>blog post</a> by <a href=http://nathanw.net/aboutme.html>Nathan Woodrow</a>, it came to me that the solution could be creating a user defined function for the expression builder to be used in labels in the map.</p><p>Closely following the blog post instructions, I have created a file called <strong>userfunctions.py</strong> in the  <strong>.qgis2/python</strong> folder and, with <a href=http://osgeo-org.1560.x6.nabble.com/How-to-get-Composer-s-name-title-using-Python-td5160691.html>a help</a> from <a href=http://nyalldawson.net/>Nyall Dawson</a> I wrote the following code.</p><p>[code language=&ldquo;Python&rdquo;]
from qgis.utils import qgsfunction, iface
from qgis.core import QGis</p><p>@qgsfunction(2,&ldquo;python&rdquo;)
def map_x_min(values, feature, parent):
 """
Returns the minimum x coordinate of a map from
a specific composer.
"""
composer_title = values[0]
map_id = values[1]
composers = iface.activeComposers()
for composer_view in composers():
composer_window = composer_view.composerWindow()
window_title = composer_window.windowTitle()
if window_title == composer_title:
composition = composer_view.composition()
map = composition.getComposerMapById(map_id)
if map:
extent = map.currentMapExtent()
break
result = extent.xMinimum()
return result
[/code]</p><p>After running the command <strong>import userfunctions</strong> in the python console  (Plugins > Python Console), it was already possible to use the  <strong>map_x_min()</strong> function (from the python category) in an expression to get the minimum X value of the map.</p><p><img src="/images/2014/09/screenshot-from-2014-09-09-162929.png?w=584" alt="Screenshot from 2014-09-09 16^%29^%29"></p><p>All I needed now was to create the other three functions,  <strong>map_x_max()</strong>, <strong>map_y_min()</strong> and** map_y_max()**.  Since part of the code would be repeated, I have decided to put it in a function called **map_bound()**, that would use the print composer title and map id as arguments, and return the map extent (in the form of a QgsRectangle).</p><p>[code language=&ldquo;Python&rdquo;]
from qgis.utils import qgsfunction, iface
from qgis.core import QGis</p><p>def map_bounds(composer_title, map_id):
"""
Returns a rectangle with the bounds of a map
from a specific composer
"""
composers = iface.activeComposers()
for composer_view in composers:
composer_window = composer_view.composerWindow()
window_title = composer_window.windowTitle()
if window_title == composer_title:
composition = composer_view.composition()
map = composition.getComposerMapById(map_id)
if map:
extent = map.currentMapExtent()
break
else:
extent = None</p><p>return extent[/code]</p><p>With this function available, I could now use it in the other functions to obtain the map X and Y minimum and maximum values, making the code more clear and easy to maintain. I also add some mechanisms to the original code to prevent errors.</p><p>[code language=&ldquo;Python&rdquo;]
@qgsfunction(2,&ldquo;python&rdquo;)
def map_x_min(values, feature, parent):
"""
Returns the minimum x coordinate of a map from a specific composer.
Calculations are in the Spatial Reference System of the project.</p><p>"""
composer_title = values[0]
map_id = values[1]
map_extent = map_bounds(composer_title, map_id)
if map_extent:
result = map_extent.xMinimum()
else:
result = None</p><p>return result</p><p>@qgsfunction(2,&ldquo;python&rdquo;)
def map_x_max(values, feature, parent):
"""
Returns the maximum x coordinate of a map from a specific composer.
Calculations are in the Spatial Reference System of the project.</p><p>"""
composer_title = values[0]
map_id = values[1]
map_extent = map_bounds(composer_title, map_id)
if map_extent:
result = map_extent.xMaximum()
else:
result = None</p><p>return result</p><p>@qgsfunction(2,&ldquo;python&rdquo;)
def map_y_min(values, feature, parent):
"""
Returns the minimum y coordinate of a map from a specific composer.
Calculations are in the Spatial Reference System of the project.</p><p>"""
composer_title = values[0]
map_id = values[1]
map_extent = map_bounds(composer_title, map_id)
if map_extent:
result = map_extent.yMinimum()
else:
result = None</p><p>return result</p><p>@qgsfunction(2,&ldquo;python&rdquo;)
def map_y_max(values, feature, parent):
"""
Returns the maximum y coordinate of a map from a specific composer.
Calculations are in the Spatial Reference System of the project.</p><p>"""
composer_title = values[0]
map_id = values[1]
map_extent = map_bounds(composer_title, map_id)
if map_extent:
result = map_extent.yMaximum()
else:
result = None</p><p>return result[/code]</p><p>The functions became available to the expression builder in the &ldquo;Python&rdquo; category (could have been any other name) and the functions descriptions are formatted as help texts to provide the user all the information needed to use them.</p><p><img src="/images/2014/09/screenshot-from-2014-09-09-153919.png?w=584" alt="Screenshot from 2014-09-09 15^%39^%19"></p><p>Using the created functions, it was now easy to put the corner coordinates in labels near the map corners. Any change to the map extents is reflected in the label, therefore quite useful to use with the atlas mode.</p><p><a href=/images/2014/09/screenshot-from-2014-09-09-154027.png><img src="/images/2014/09/screenshot-from-2014-09-09-154027.png?w=584" alt="Screenshot from 2014-09-09 15^%40^%27"></a></p><p>The functions result can be used with other functions. In the following image, there is an expression to show the coordinates in a more compact way.</p><p><a href=/images/2014/09/screenshot-from-2014-09-09-154355.png><img src="/images/2014/09/screenshot-from-2014-09-09-154355.png?w=584" alt="Screenshot from 2014-09-09 15^%43^%55"></a></p><p>There was a setback&mldr; For the functions to become available, it was necessary to manually import them in each QGIS session. Not very practical. Again with Nathan&rsquo;s <a href=http://osgeo-org.1560.x6.nabble.com/How-to-import-a-user-defined-expression-functions-on-QGIS-start-up-td5159062.html>help</a>, I found out that it&rsquo;s possible to import python modules at QGIS startup by putting a <strong>startup.py</strong> file with the import statements in the <strong>.qgis2/python</strong> folder. In my case, this was enough.</p><p>[code language=&ldquo;Python&rdquo;]
import userfunctions
[/code]</p><p>I was pretty satisfied with the end result. The ability to create your own functions in expressions demonstrates once more how easy it is to customize QGIS and create your own tools. I&rsquo;m already thinking in more applications for this amazing functionality.</p><p><a href=/images/2014/09/ut-9-qta-da-peninha-vegetac3a7c3a3o-potencial.jpg><img src="/images/2014/09/ut-9-qta-da-peninha-vegetac3a7c3a3o-potencial.jpg?w=584" alt="UT 9 - Qta da Peninha - Vegetação potencial"></a></p><p>You can download the Python files with the functions <a href="https://www.dropbox.com/s/b0ejc7216eboach/user_functions.zip?dl=0">HERE</a>. Just unzip both files to the .qgis2/python folder, and restart QGIS, and the functions should become available.</p><p>**Disclaimer: **I&rsquo;m not an English native speaker, therefore I apologize for any errors, and I will thank any advice on how to improve the text.</p></div><div class=btn-improve-page><a href=https://github.com/SrNetoChan/SrNetoChan.github.io/edit//content/posts/tutorials/2014-09-09-coordenadas-dos-cantos-do-mapa-em-qgis-map-corner-coordinates-in-qgis.markdown target=_blank><i class="fas fa-code-branch"></i>Improve this page</a></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/tutorials/2014-11-09-series-de-mapas-com-formatos-multiplos-em-qgis-2-6-parte-1-multiple-format-map-series-using-qgis-2-6-part-1/ class="btn btn-outline-info"><div><i class="fas fa-chevron-circle-left"></i>Prev</div><div class=next-prev-text>Multiple format map series using QGIS 2.6 - Part 1</div></a></div><div class="col-md-6 next-article"><a href=/posts/tutorials/2014-06-24-use-o-operador-in-sff-please-use-the-in-operator/ class="btn btn-outline-info"><div>Next <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>Please use the "IN" operador</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a><div class="dropdown languageSelector"><a class="btn dropdown-toggle" href=# id=languageSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img class=flag src=https://www.countryflags.io/gb/flat/16.png alt=gb>
English</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/pt/posts/tutorials/2014-09-09-coordenadas-dos-cantos-do-mapa-em-qgis-map-corner-coordinates-in-qgis><img class=flag src=https://www.countryflags.io/pt/flat/24.png alt=pt>
Português</a></div></div></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=/#skills>Services</a></li><li class=nav-item><a class=smooth-scroll href=/#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=/#recent-posts>Recent Posts</a></li><li class=nav-item><a class=smooth-scroll href=/#achievements>Map Gallery</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><span>Email:</span> <span>info[at]alexandreneto[dot]eu</span></li><li><span>Twitter:</span> <span>@alexnetogeo</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=_blank><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_2.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2021 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>