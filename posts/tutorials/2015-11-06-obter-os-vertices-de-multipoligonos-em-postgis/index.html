<!doctype html><html><head><title>Getting multipolygon vertexes using PostGIS</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600"><link rel=stylesheet href=/fontawesome/css/all.min.css><meta property="og:title" content="Getting multipolygon vertexes using PostGIS"><meta property="og:description" content="Today I needed to create a view in PostGIS that returned the vertexes of a multi-polygon layer. Besides, I needed that they were numerically ordered starting in 1, and with the respective XY coordinates.
It seemed to be a trivial task – all I would need was to use the ST_DumpPoints() function to get all vertexes – if it wasn&rsquo;t for the fact that PostGIS polygons have a duplicate vertex (the last vertex must be equal to the first one) that I have no interess in showing."><meta property="og:type" content="article"><meta property="og:url" content="https://srnetochan.github.io/posts/tutorials/2015-11-06-obter-os-vertices-de-multipoligonos-em-postgis/"><meta property="article:published_time" content="2015-11-06T00:49:01+00:00"><meta property="article:modified_time" content="2015-11-06T00:49:01+00:00"><meta name=description content="Getting multipolygon vertexes using PostGIS"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/>Alexandre Neto</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=languageSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="flag-icon flag-icon-gb"></span>English</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/pt/posts/tutorials/2015-11-06-obter-os-vertices-de-multipoligonos-em-postgis><span class="flag-icon flag-icon-pt"></span>Português</a></div></li></ul></div></div></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href=/posts/opinion/>Opinion articles</a><ul><li><a href=/posts/opinion/2013-03-26-nota-de-abertura/ title="Welcome note">Welcome note</a></li><li><a href=/posts/opinion/2013-03-31-porque-o-open-source/ title="Open Source, why?">Open Source, why?</a></li></ul></li><li><a href=/posts/news/ title=News>News</a></li><li><a href=/posts/tutorials/ title=Tutorials>Tutorials</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://srnetochan.github.io/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/aneto2_hu3ba7f484d115ecd4e89b152fb4092700_544820_120x120_fit_q75_box.jpg alt="Author Image"><h5 class=author-name>Alexandre Neto</h5><p>:date_full</p></div><div class=title><h1>Getting multipolygon vertexes using PostGIS</h1></div><div class=post-content id=post-content><p>Today I needed to create a view in <a href=http://postgis.net/>PostGIS</a> that returned the vertexes of a multi-polygon layer. Besides, I needed that they were numerically ordered starting in 1, and with the respective XY coordinates.</p><p><img src=/images/2015/11/screenshot-from-2015-11-05-235819.png alt="Screenshot from 2015-11-05 23:58:19"></p><p>It seemed to be a trivial task – all I would need was to use the <a href=http://postgis.net/docs/ST_DumpPoints.html>ST_DumpPoints()</a> function to get all vertexes – if it wasn&rsquo;t for the fact that PostGIS polygons have a duplicate vertex (the last vertex must be equal to the first one) that I have no interess in showing.</p><p>After some try-and-fail, I came up with the following query:</p><p>[code language=&ldquo;SQL&rdquo;]
CREATE OR REPLACE VIEW public.my_polygons_vertexes AS
WITH t AS &ndash; Transfor polygons in sets of points
(SELECT id_polygon,
st_dumppoints(geom) AS dump
FROM public.my_polygons),
f AS &ndash; Get the geometry and the indexes from the sets of points
(SELECT t.id_polygon,
(t.dump).path[1] AS part,
(t.dump).path[3] AS vertex,
(t.dump).geom AS geom
FROM t)
&ndash; Get all points filtering the last point for each geometry part
SELECT row_number() OVER () AS gid, &ndash; Creating a unique id
f.id_polygon,
f.part,
f.vertex,
ST_X(f.geom) as x, &ndash; Get point&rsquo;s X coordinate
ST_Y(f.geom) as y, &ndash; Get point&rsquo;s Y coordinate
f.geom::geometry(&lsquo;POINT&rsquo;,4326) as geom &ndash; make sure of the resulting geometry type
FROM f
WHERE (f.id_polygon, f.part, f.vertex) NOT IN
(SELECT f.id_polygon,
f.part,
max(f.vertex) AS max
FROM f
GROUP BY f.id_polygon,
f.part);
[/code]</p><p>The interesting part occurs in the WHERE clause, basically, from the list of all vertexes, only the ones not included in the list of vertexes with the maximum index by polygon part are showed, that is, the last vertex of each polygon part.</p><p>Here&rsquo;s the result:</p><p><a href=/images/2015/11/screenshot-from-2015-11-05-235840.png><img src=/images/2015/11/screenshot-from-2015-11-05-235840.png alt="Screenshot from 2015-11-05 23:58:40"></a></p><p>The advantage of this approach (using PostGIS) instead of using &ldquo;Polygons to Lines&rdquo; and &ldquo;Lines to points&rdquo; processing tools is that we just need to change the polygons layer, and save it, to see our vertexes get updated automatically. It&rsquo;s because of this kind of stuff that I love <a href=http://postgis.net/>PostGIS</a>.</p></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/SrNetoChan/SrNetoChan.github.io/edit/main/content/posts/tutorials/2015-11-06-obter-os-vertices-de-multipoligonos-em-postgis.markdown title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>Improve this page</a></div></div><hr><div class="row next-prev-navigator"></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a><div class="dropdown languageSelector"><a class="btn dropdown-toggle" href=# id=languageSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="flag-icon flag-icon-gb"></span>English</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/pt/posts/tutorials/2015-11-06-obter-os-vertices-de-multipoligonos-em-postgis><span class="flag-icon flag-icon-pt"></span>Português</a></div></div></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://srnetochan.github.io/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://srnetochan.github.io/#skills>Services</a></li><li class=nav-item><a class=smooth-scroll href=https://srnetochan.github.io/#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=https://srnetochan.github.io/#recent-posts>Recent Posts</a></li><li class=nav-item><a class=smooth-scroll href=https://srnetochan.github.io/#achievements>Map Gallery</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:info[at]alexandreneto[dot]eu target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span><span>info[at]alexandreneto[dot]eu</span></a></li><li><span>Twitter:</span> <span>@alexnetogeo</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_2.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2021 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>